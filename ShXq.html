<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="layui/css/layui.css"  media="all">
    <script src="js/0_common/jquery.min.js"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <style>
        .layui-input{
            border-color: #ffffff;

        }
    </style>
</head>
<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>企业复工复产申请详情</legend>
</fieldset>

<div class="layui-form-item">
    <div class="" style="width: 783px;">
        <label class="layui-form-label">企业名称</label>
        <div class="layui-input-block">
            <input type="text" id="zd2" name="zd2" lay-verify="title" autocomplete="off" placeholder="请输入企业名称" class="layui-input">
        </div>
    </div>
</div>
<div class="layui-form-item">
    <div class="layui-inline">
        <label class="layui-form-label">企业统一社会信用代码</label>
        <div class="layui-input-block">
            <input type="text" name="zd1" lay-verify="content" autocomplete="off" placeholder="请输入企业统一社会信用代码" class="layui-input">
        </div>
    </div>
    <div class="layui-inline">
        <label class="layui-form-label">单位地址</label>
        <div class="layui-input-block">
            <input type="text" id="zd4" name="zd4" lay-verify="title" autocomplete="off" placeholder="请输入单位地址" class="layui-input">
        </div>
    </div>
</div>

<div class="layui-form-item">
    <div class="layui-inline">
        <label class="layui-form-label">所属区县</label>
        <div class="layui-input-block">
            <input type="text" id="zd3" name="zd3" lay-verify="title" autocomplete="off" placeholder="请输入所属区县" class="layui-input">
        </div>
    </div>
    <div class="layui-inline">
        <label class="layui-form-label">所属街道（镇）</label>
        <div class="layui-input-block">
            <input type="text" id="zd22" name="zd22" lay-verify="title" autocomplete="off" placeholder="请输入所属街道（镇）" class="layui-input">
        </div>
    </div>

</div>
<div class="layui-form-item">
    <div class="layui-inline">
        <label class="layui-form-label">法人代表</label>
        <div class="layui-input-block">
            <input type="text" id="zd5" name="zd5" lay-verify="title" autocomplete="off" placeholder="请输入法人代表" class="layui-input">
        </div>
    </div>
    <div class="layui-inline">
        <label class="layui-form-label">法人联系方式</label>
        <div class="layui-input-block">
            <input type="text" id="zd6" name="zd6" lay-verify="phone" autocomplete="off" placeholder="请输入手机号" class="layui-input">
        </div>
    </div>
</div>
<div class="layui-form-item">
    <div class="layui-inline">
        <label class="layui-form-label">员工总数</label>
        <div class="layui-input-block">
            <input type="text" id="zd7" name="zd7" lay-verify="title" autocomplete="off" placeholder="请输入员工总数" class="layui-input">
        </div>
    </div>
    <div class="layui-inline">
        <label class="layui-form-label">疫情防控重点地区员工数</label>
        <div class="layui-input-block">
            <input type="text" name="zd8" lay-verify="title" autocomplete="off" placeholder="请输入疫情防控重点地区员工数" class="layui-input">
        </div>
    </div>
</div>
<div class="layui-form-item">

    <div class="layui-inline">
        <label class="layui-form-label">申请复工人数</label>
        <div class="layui-input-block">
            <input type="text" name="zd9" lay-verify="title" autocomplete="off" placeholder="请输入申请复工人数" class="layui-input">
        </div>
    </div>
    <div class="layui-inline">
        <label class="layui-form-label">疫情防控重点地区复工人数</label>
        <div class="layui-input-block">
            <input type="text" name="zd10" lay-verify="title" autocomplete="off" placeholder="请输入疫情防控重点地区复工人数" class="layui-input">
        </div>
    </div>
</div>
</div>
<div class="layui-form-item">
    <div class="layui-inline">
        <label class="layui-form-label">复工日期</label>
        <div class="layui-input-block">
            <input type="text" name="zd11" lay-verify="title" autocomplete="off"  class="layui-input">
        </div>
    </div>
    <div class="layui-inline">
        <label class="layui-form-label">填报日期</label>
        <div class="layui-input-block">
            <input type="text" name="zd12" lay-verify="title" autocomplete="off"  class="layui-input">
        </div>
    </div>
</div>

    <div class="layui-form-item">
        <label class="layui-form-label">复工申请单</label>
        <div class="layui-input-block">
            <input type="text" name="zd13" id="input1" lay-verify="" autocomplete="off" placeholder="" class="layui-input" style="display: initial;width: 26.5%;" >
            <button type="button" class="layui-btn" id="test4"><i class="layui-icon"></i>下载</button>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">疫情防控工作方案</label>
        <div class="layui-input-block">
            <input type="text" name="zd14" id="input2" lay-verify="" autocomplete="off" placeholder="" class="layui-input" style="display: initial;width: 26.5%;" >
            <button type="button" class="layui-btn" id="test5"><i class="layui-icon"></i>下载</button>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">复工生产方案</label>
        <div class="layui-input-block">
            <input type="text" name="zd15" id="input3" lay-verify="title" autocomplete="off" placeholder="" class="layui-input" style="display: initial;width: 26.5%;" >
            <button type="button" class="layui-btn" id="test6"><i class="layui-icon"></i>下载</button>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">承诺书</label>
        <div class="layui-input-block">
            <input type="text" name="zd16" id="input4" lay-verify="title" autocomplete="off" placeholder="" class="layui-input" style="display: initial;width: 26.5%;" >
            <button type="button" class="layui-btn" id="test7"><i class="layui-icon"></i>下载</button>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">厂区照片</label>
        <div class="layui-upload">
            <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;width: 30%; margin-left: 190px">
                预览图：
                <div class="layui-upload-list" id="demo5"></div>
            </blockquote>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">办公区照片</label>
        <div class="layui-upload">
            <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;width: 30%; margin-left: 190px">
                预览图：
                <div class="layui-upload-list" id="demo6"></div>
            </blockquote>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">食堂照片</label>
        <div class="layui-upload">
            <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;width: 30%; margin-left: 190px">
                预览图：
                <div class="layui-upload-list" id="demo7"></div>
            </blockquote>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">应急物资照片</label>
        <div class="layui-upload">
            <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;width: 30%; margin-left: 190px">
                预览图：
                <div class="layui-upload-list" id="demo8"></div>
            </blockquote>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">物资订单照片</label>
        <div class="layui-upload">
            <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;width: 30%; margin-left: 190px">
                预览图：
                <div class="layui-upload-list" id="demo9"></div>
            </blockquote>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">员工相关信息</label>
        <div class="layui-upload">
            <button class="layui-btn layui-btn-warm" onclick="yg()">查看</button>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">审核</label>
        <select id="shenhejieguo"  style="margin-top: 9px;height: 25px;margin-left: -7px;">
            <option value="不通过">不通过</option>
            <option value="通过">通过</option>
        </select>
    </div>

    <div class="layui-form-item"  id="noteTips">
        <label class="layui-form-label">备注</label>
        <textarea id="shenheyijian" style="width: 33%;margin-left: -6px;" rows="5"></textarea>
    </div>

    <div class="layui-form-item">
        <div class="layui-input-block">

            <button class="layui-btn" onclick="gb()">审核</button>
        </div>
    </div>

</ul>
<script src="layui/layui.js" charset="utf-8"></script>
<script src="js/constants.js"></script>
<script src="js/0_common/jquery.min.js"></script>
<script src="layui/jquery.serializejson.min.js"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
     var  id = getQueryString("id").split(",")[0];
     var rowqyid =  getQueryString("id").split(",")[1];
    var ctx = Constants.path;
    var svcHeader = Constants.path;
    var qyid = localStorage.getItem('qyid');
    var qymc = localStorage.getItem('qymc');
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r !== null)
            return unescape(r[2]);
        return null;
    }
    function gb(){
        if($("#shenhejieguo").val()=="不通过"&&$("#shenheyijian").val()==""){
            alert("请补全审核内容！");
        }else{
            var obj = {
                "qyid":rowqyid,
                "shenhejieguo": $("#shenhejieguo").val(),
                "shenheyijian": $("#shenheyijian").val(),
                "shren": qymc,
                "shshijian": new Date,
            }
            $.ajax({
                url: svcHeader + "pv/shenhes",
                dataType: 'json',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify(obj),
                success: function (data) {
                    $.ajax({
                        url: svcHeader + "pb/qyxxs/"+rowqyid,
                        dataType: 'json',
                        type: 'get',
                        success:function(data){
                            var qyObj = data.data;
                            qyObj.status =  ($("#shenhejieguo").val()=="通过")?'3':'4';
                           $.ajax({
                               url: svcHeader + "pv/qyxxs/"+rowqyid,
                               dataType: 'json',
                               type: 'put',
                               contentType: 'application/json',
                               data: JSON.stringify(qyObj),
                               success: function(data){
                                   alert('审核成功！');
                                   parent.layer.closeAll();
                                   window.parent.location.reload();
                               }
                           })
                        }
                    });

                },
            })
        }

    }
    $.ajax({
        type: "get",
        url: ctx + "pb/qysqbs/"+id,
        success: function(r) {
            var d = r.data;
            if (r.code == "200"){
                $("input[name='zd1']").val(d.zd1)
                $("input[name='zd2']").val(d.zd2)
                $("input[name='zd3']").val(d.zd3)
                $("input[name='zd4']").val(d.zd4)
                $("input[name='zd5']").val(d.zd5)
                $("input[name='zd6']").val(d.zd6)
                $("input[name='zd7']").val(d.zd7)
                $("input[name='zd8']").val(d.zd8)
                $("input[name='zd9']").val(d.zd9)
                $("input[name='zd10']").val(d.zd10)
                $("input[name='zd11']").val(d.zd11)
                $("input[name='zd12']").val(d.zd12)
                $("input[name='zd13']").val(d.zd13)
                $("input[name='zd14']").val(d.zd14)
                $("input[name='zd15']").val(d.zd15)
                $("input[name='zd16']").val(d.zd16)
                $("input[name='zd22']").val(d.zd22)
                f(d.zd17,"demo5")
                f(d.zd18,"demo6")
                f(d.zd19,"demo7")
                f(d.zd20,"demo8")
                f(d.zd21,"demo9")
            }
        }
    })
    var file = ctx+"FUGONGP/"
    $("#test4").click(function () {
        var fileName = $("input[name='zd13']").val();
        if (fileName != ""){
            window.location.href = file + fileName;
        }
    })
    $("#test5").click(function () {
        var fileName = $("input[name='zd14']").val();
        if (fileName != ""){
            window.location.href = file + fileName;
        }
    })
    $("#test6").click(function () {
        var fileName = $("input[name='zd15']").val();
        if (fileName != ""){
            window.location.href = file + fileName;
        }
    })
    $("#test7").click(function () {
        var fileName = $("input[name='zd16']").val();
        if (fileName != ""){
            window.location.href = file + fileName;
        }
    })
    function f(urls,id) {
        if (urls != null && urls != ""){
        var url = urls.split(",");
        $.each(url,function (i,u) {
            $('#'+id).append('<img src="'+ file + u +'" alt="'+ file + u +'" style = "width: 200px;" class="layui-upload-img">')
        })
        }
    }
    $('#shenhejieguo').change(() => {
        if($("#shenhejieguo").val()=="不通过"){
            $("#noteTips").show();
        }else{
            $("#noteTips").hide();
        }
    });

    var layer;
    layui.use(['form'], function(){
        layer   = layui.layer
    })
    //查看详情
    function yg() {
        localStorage.setItem('qyid',rowqyid);
        layer.open({
            type: 2,
            title:"申报详情",
            content: 'main2.html',
            offset: 'rb',
            area: ['70%', '90%']
        });
    }
</script>

</body>
</html>